
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verbs &#8212; semantique 0.1.0 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced usage" href="advanced.html" />
    <link rel="prev" title="References" href="references.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">semantique 0.1.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Documentation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../guide.html">
   User Guide
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="intro.html">
     Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="references.html">
     References
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Verbs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="advanced.html">
     Advanced usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../reference.html">
   API Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.QueryRecipe.html">
     semantique.QueryRecipe
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.ontology.Ontology.html">
     semantique.ontology.Ontology
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.ontology.Semantique.html">
     semantique.ontology.Semantique
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.factbase.Factbase.html">
     semantique.factbase.Factbase
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.factbase.Opendatacube.html">
     semantique.factbase.Opendatacube
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.factbase.GeotiffArchive.html">
     semantique.factbase.GeotiffArchive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.extent.SpatialExtent.html">
     semantique.extent.SpatialExtent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.extent.TemporalExtent.html">
     semantique.extent.TemporalExtent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.concept.html">
     semantique.concept
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.entity.html">
     semantique.entity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.event.html">
     semantique.event
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.resource.html">
     semantique.resource
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.appearance.html">
     semantique.appearance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.artifacts.html">
     semantique.artifacts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.atmosphere.html">
     semantique.atmosphere
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.reflectance.html">
     semantique.reflectance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.topography.html">
     semantique.topography
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.collection.html">
     semantique.collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.evaluate.html">
     semantique.CubeProxy.evaluate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.extract.html">
     semantique.CubeProxy.extract
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.filter.html">
     semantique.CubeProxy.filter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.filter_time.html">
     semantique.CubeProxy.filter_time
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.filter_space.html">
     semantique.CubeProxy.filter_space
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.groupby.html">
     semantique.CubeProxy.groupby
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.groupby_time.html">
     semantique.CubeProxy.groupby_time
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.groupby_space.html">
     semantique.CubeProxy.groupby_space
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.label.html">
     semantique.CubeProxy.label
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeProxy.reduce.html">
     semantique.CubeProxy.reduce
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.compose.html">
     semantique.CubeCollectionProxy.compose
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.concatenate.html">
     semantique.CubeCollectionProxy.concatenate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.merge.html">
     semantique.CubeCollectionProxy.merge
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.evaluate.html">
     semantique.CubeCollectionProxy.evaluate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.extract.html">
     semantique.CubeCollectionProxy.extract
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.filter.html">
     semantique.CubeCollectionProxy.filter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.filter_time.html">
     semantique.CubeCollectionProxy.filter_time
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.filter_space.html">
     semantique.CubeCollectionProxy.filter_space
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.label.html">
     semantique.CubeCollectionProxy.label
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.CubeCollectionProxy.reduce.html">
     semantique.CubeCollectionProxy.reduce
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.value_label.html">
     semantique.value_label
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.geometries.html">
     semantique.geometries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.time_instant.html">
     semantique.time_instant
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.time_interval.html">
     semantique.time_interval
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.core.QueryProcessor.html">
     semantique.processor.core.QueryProcessor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.structures.Cube.html">
     semantique.processor.structures.Cube
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.structures.CubeCollection.html">
     semantique.processor.structures.CubeCollection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.absolute_.html">
     semantique.processor.operators.absolute_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.cube_root_.html">
     semantique.processor.operators.cube_root_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.natural_logarithm_.html">
     semantique.processor.operators.natural_logarithm_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.square_root_.html">
     semantique.processor.operators.square_root_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.invert_.html">
     semantique.processor.operators.invert_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.add_.html">
     semantique.processor.operators.add_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.divide_.html">
     semantique.processor.operators.divide_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.multiply_.html">
     semantique.processor.operators.multiply_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.power_.html">
     semantique.processor.operators.power_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.subtract_.html">
     semantique.processor.operators.subtract_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.and_.html">
     semantique.processor.operators.and_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.or_.html">
     semantique.processor.operators.or_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.equal_.html">
     semantique.processor.operators.equal_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.exclusive_or_.html">
     semantique.processor.operators.exclusive_or_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.greater_.html">
     semantique.processor.operators.greater_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.greater_equal_.html">
     semantique.processor.operators.greater_equal_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.in_.html">
     semantique.processor.operators.in_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.less_.html">
     semantique.processor.operators.less_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.less_equal_.html">
     semantique.processor.operators.less_equal_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.not_equal_.html">
     semantique.processor.operators.not_equal_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.not_in_.html">
     semantique.processor.operators.not_in_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.after_.html">
     semantique.processor.operators.after_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.before_.html">
     semantique.processor.operators.before_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.during_.html">
     semantique.processor.operators.during_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.operators.assign_.html">
     semantique.processor.operators.assign_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.mean_.html">
     semantique.processor.reducers.mean_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.product_.html">
     semantique.processor.reducers.product_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.standard_deviation_.html">
     semantique.processor.reducers.standard_deviation_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.sum_.html">
     semantique.processor.reducers.sum_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.variance_.html">
     semantique.processor.reducers.variance_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.all_.html">
     semantique.processor.reducers.all_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.any_.html">
     semantique.processor.reducers.any_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.count_.html">
     semantique.processor.reducers.count_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.percentage_.html">
     semantique.processor.reducers.percentage_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.first_.html">
     semantique.processor.reducers.first_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.last_.html">
     semantique.processor.reducers.last_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.mode_.html">
     semantique.processor.reducers.mode_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.max_.html">
     semantique.processor.reducers.max_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.median_.html">
     semantique.processor.reducers.median_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.reducers.min_.html">
     semantique.processor.reducers.min_
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.utils.convert_datetime64.html">
     semantique.processor.utils.convert_datetime64
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.utils.create_extent_cube.html">
     semantique.processor.utils.create_extent_cube
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.utils.parse_datetime_component.html">
     semantique.processor.utils.parse_datetime_component
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.processor.templates.html">
     semantique.processor.templates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.AlignmentError.html">
     semantique.exceptions.AlignmentError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.EmptyDataError.html">
     semantique.exceptions.EmptyDataError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.InvalidValueTypeError.html">
     semantique.exceptions.InvalidValueTypeError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.InvalidBuildingBlockError.html">
     semantique.exceptions.InvalidBuildingBlockError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.UnknownConceptError.html">
     semantique.exceptions.UnknownConceptError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.UnknownResourceError.html">
     semantique.exceptions.UnknownResourceError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.UnknownResultError.html">
     semantique.exceptions.UnknownResultError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.UnknownReducerError.html">
     semantique.exceptions.UnknownReducerError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.UnknownOperatorError.html">
     semantique.exceptions.UnknownOperatorError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.UnknownDimensionError.html">
     semantique.exceptions.UnknownDimensionError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.UnknownComponentError.html">
     semantique.exceptions.UnknownComponentError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.UnknownLabelError.html">
     semantique.exceptions.UnknownLabelError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.TooManyDimensionsError.html">
     semantique.exceptions.TooManyDimensionsError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.MissingDimensionError.html">
     semantique.exceptions.MissingDimensionError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.MixedDimensionsError.html">
     semantique.exceptions.MixedDimensionsError
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../_generated/semantique.exceptions.MixedTimeZonesError.html">
     semantique.exceptions.MixedTimeZonesError
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gallery.html">
   Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../changelog.html">
   Changelog
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Community
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../code_of_conduct.html">
   Code of Conduct
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributing.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ZGIS/semantique">
   GitHub repository
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/_notebooks/verbs.nblink.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.nblink</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ZGIS/semantique"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ZGIS/semantique/issues/new?title=Issue%20on%20page%20%2F_notebooks/verbs.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ZGIS/semantique/edit/main/docs/source/_notebooks/verbs.nblink"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Content">
   Content
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Prepare">
   Prepare
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Verbs-for-single-data-cubes">
   Verbs for single data cubes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Evaluate">
     Evaluate
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Simple-univariate-expressions">
       Simple univariate expressions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Univariate-expressions-involving-constants">
       Univariate expressions involving constants
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Multivariate-expressions">
       Multivariate expressions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Aligning-data-cubes-to-the-same-shape">
       Aligning data cubes to the same shape
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#The-assignment-operator">
       The assignment operator
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Temporal-relational-operators">
       Temporal relational operators
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Extract">
     Extract
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Filter">
     Filter
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Aligning-the-filterer">
       Aligning the filterer
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#The-filter_time-and-filter_space-verbs">
       The filter_time and filter_space verbs
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Self-filtering">
       Self-filtering
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Reduce">
     Reduce
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Groupby">
     Groupby
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#The-groupby_time-and-groupby_space-verbs">
       The groupby_time and groupby_space verbs
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Multiple-groupers">
       Multiple groupers
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Label">
     Label
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Verbs-for-data-cube-collections">
   Verbs for data cube collections
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Concatenate">
     Concatenate
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Concatenating-along-a-new-dimension">
       Concatenating along a new dimension
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Concatenating-over-an-existing-dimension">
       Concatenating over an existing dimension
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Compose">
     Compose
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Merge">
     Merge
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Evaluating-single-cube-verbs-on-collections">
     Evaluating single cube verbs on collections
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Verbs">
<h1>Verbs<a class="headerlink" href="#Verbs" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we will show what kind of action each action block (i.e. each <em>verb</em>) performs. Remember from the <a class="reference internal" href="intro.html"><span class="doc">Intro notebook</span></a> that result instructions are formulated by combining basic building blocks into processing chains. These processing chains start with a reference (e.g. to a semantic concepts) which during query processing is internally evaluated into a <em>data cube</em>. For a description of those, see the <a class="reference internal" href="references.html"><span class="doc">References notebook</span></a>. Actions are distinct,
well-defined data cube operations that can then be applied to these data cubes. Since they are all labelled with an action word that describes their task, we also call them <em>verbs</em>.</p>
<p>This notebook will show how these verbs are internally called and executed by the query processor. Although this internal handling is not something you need to deal with as an end-user, understanding it should give you a clearer idea of what each verb exactly does, and also provide a way to test the verbs outside the query processing workflow. At all examples, we will also show the code you would use at the query recipe construction phase to obtain the same result.</p>
<div class="section" id="Content">
<h2>Content<a class="headerlink" href="#Content" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#Verbs-for-single-data-cubes">Verbs for single data cubes</a></p>
<ul>
<li><p><a class="reference external" href="#Evaluate">Evaluate</a></p></li>
<li><p><a class="reference external" href="#Extract">Extract</a></p></li>
<li><p><a class="reference external" href="#Filter">Filter</a></p>
<ul>
<li><p><a class="reference external" href="#The-filter_time-and-filter_space-verbs">filter_time</a></p></li>
<li><p><a class="reference external" href="#The-filter_time-and-filter_space-verbs">filter_space</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#Reduce">Reduce</a></p></li>
<li><p><a class="reference external" href="#Groupby">Groupby</a></p>
<ul>
<li><p><a class="reference external" href="#The-groupby_time-and-groupby_space-verbs">groupby_time</a></p></li>
<li><p><a class="reference external" href="#The-groupby_time-and-groupby_space-verbs">groupby_space</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#Label">Label</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#Verbs-for-data-cube-collections">Verbs for data cube collections</a></p>
<ul>
<li><p><a class="reference external" href="#Concatenate">Concatenate</a></p></li>
<li><p><a class="reference external" href="#Compose">Compose</a></p></li>
<li><p><a class="reference external" href="#Merge">Merge</a></p></li>
<li><p><a class="reference external" href="#Evaluating-single-cube-verbs-on-collections">Evaluating single cube verbs on collections</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="Prepare">
<h2>Prepare<a class="headerlink" href="#Prepare" title="Permalink to this headline">¶</a></h2>
<p>Import the semantique package:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import semantique as sq
from semantique.processor.utils import create_extent_cube
</pre></div>
</div>
</div>
<p>Import other packages we will use in this notebook:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import geopandas as gpd
import pandas as pd
import numpy as np
import xarray as xr
import json
</pre></div>
</div>
</div>
<p>Now we get some example data to work with. We will ask the ontology to translate some concept references into boolean data cubes, and also ask our demo factbase to retrieve some information layers directly. We will use a very coarse spatial resolution such that we can easily see all values in the data cubes and how they get wrangled by the verbs. For the same reason, we will also round floating point values to one digit.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Initialize the ontology.
with open(&quot;files/ontology.json&quot;, &quot;r&quot;) as file:
    ontology = sq.ontology.Semantique(json.load(file))

# Initialize the factbase.
with open(&quot;files/factbase.json&quot;, &quot;r&quot;) as file:
    factbase = sq.factbase.GeotiffArchive(json.load(file), src = &quot;files/resources.zip&quot;)

# Create a spatio-temporal extent cube.
space = sq.SpatialExtent(gpd.read_file(&quot;files/footprint.geojson&quot;))
time = sq.TemporalExtent(&quot;2019-01-01&quot;, &quot;2020-12-31&quot;)
extent = create_extent_cube(space, time, spatial_resolution = [-1800, 1800], crs = 3035, tz = &quot;UTC&quot;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Translate some semantic concept definitions.
water = ontology.translate(&quot;entity&quot;, &quot;water&quot;, factbase = factbase, extent = extent)
vegetation = ontology.translate(&quot;entity&quot;, &quot;vegetation&quot;, factbase = factbase, extent = extent)
snow = ontology.translate(&quot;entity&quot;, &quot;snow&quot;, factbase = factbase, extent = extent)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>concepts = xr.concat([water, vegetation, snow], &quot;concept&quot;).rename(&quot;concepts&quot;)
concepts.coords[&quot;concept&quot;] = [&quot;water&quot;, &quot;vegetation&quot;, &quot;snow&quot;]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>values = [0, 1]
levels = [x - 0.5 for x in values + [max(values) + 1]]
colors = [&quot;#d3d3d3&quot;, &quot;#77abb7&quot;]
legend = {&quot;ticks&quot;: values, &quot;label&quot;: &quot;observed&quot;}
concepts.unstack().plot(col = &quot;time&quot;, row = &quot;concept&quot;, levels = levels, colors = colors, cbar_kwargs = legend)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.plot.facetgrid.FacetGrid at 0x7f4cec5c7ee0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_notebooks_verbs_8_1.png" src="../_images/_notebooks_verbs_8_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Retrieve the greenness resource.
greenness = factbase.retrieve(&quot;appearance&quot;, &quot;greenness&quot;, extent = extent).round(1)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>greenness.unstack().plot(col = &quot;time&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.plot.facetgrid.FacetGrid at 0x7f4cec5ced90&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_notebooks_verbs_10_1.png" src="../_images/_notebooks_verbs_10_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Retrieve the brightness resource.
brightness = factbase.retrieve(&quot;appearance&quot;, &quot;brightness&quot;, extent = extent).round(1)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>brightness.unstack().plot(col = &quot;time&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.plot.facetgrid.FacetGrid at 0x7f4cec86da00&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_notebooks_verbs_12_1.png" src="../_images/_notebooks_verbs_12_1.png" />
</div>
</div>
</div>
<div class="section" id="Verbs-for-single-data-cubes">
<h2>Verbs for single data cubes<a class="headerlink" href="#Verbs-for-single-data-cubes" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">semantique</span></code> uses <a class="reference external" href="http://xarray.pydata.org/en/stable/user-guide/data-structures.html#dataarray">DataArray</a> objects from the <code class="docutils literal notranslate"><span class="pre">xarray</span></code> package to represent data cubes. It extends this class by adding a semantique-specific accessor named <code class="docutils literal notranslate"><span class="pre">sq</span></code>. All the verbs that are meant to be applied on single data cubes are implemented as methods of this accessor. In practice, that means that you can call these verbs in the following form:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xarray_object</span><span class="o">.</span><span class="n">sq</span><span class="o">.</span><span class="n">verb</span><span class="p">()</span>
</pre></div>
</div>
<p>Using accessors instead of the common class inheritance is recommended by the developers of <code class="docutils literal notranslate"><span class="pre">xarray</span></code>. Read more about it <a class="reference external" href="http://xarray.pydata.org/en/stable/internals/extending-xarray.html">here</a>. The internal application of verbs is only shown to examplify their functionalities. Whenever you construct a query recipe, you do <strong>not</strong> call the verbs in this way. At that stage, “data cubes” are simple textual references that do not contain any data just yet, and you simply formulate a
processing chain as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">verb</span><span class="p">()</span>
</pre></div>
</div>
<p>The currently implemented verbs are:</p>
<ul class="simple">
<li><p><a class="reference external" href="#Evaluate">Evaluate</a>: Evaluates an expression for each pixel in a data cube.</p></li>
<li><p><a class="reference external" href="#Extract">Extract</a>: Extracts dimension coordinates of a specified dimension in a data cube.</p></li>
<li><p><a class="reference external" href="#Filter">Filter</a>: Filters values from a data cube.</p></li>
<li><p><a class="reference external" href="#Reduce">Reduce</a>: Reduces sets of values along a specified dimension to one and subsequently removes that dimension.</p></li>
<li><p><a class="reference external" href="#Replace">Replace</a>: Replaces all values in a data cube.</p></li>
<li><p><a class="reference external" href="#Groupby">Groupby</a>: Groups a data cube into a collection of multiple subsets.</p></li>
<li><p><a class="reference external" href="#Label">Label</a>: Assigns a label to a data cube.</p></li>
</ul>
<div class="section" id="Evaluate">
<h3>Evaluate<a class="headerlink" href="#Evaluate" title="Permalink to this headline">¶</a></h3>
<p>The evaluate verb evaluates an expression for each pixel in the input data cube. These expressions can take many different forms, but each of them accepts a pixel value of the input cube as input, and applies some operator to it. The result of that operation is the new value of that particular pixel in the output cube. That is, the output cube always has the <em>same shape</em> as the input cube.</p>
<p>Several common operators are built in to <code class="docutils literal notranslate"><span class="pre">semantique</span></code>. When you construct a semantic query recipe, you can simply call them by their name, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;invert&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, since we are now calling the verbs directly as methods of <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code> object, we need to provide the operator <em>functions</em> themselves. For that, we load the operators module of <code class="docutils literal notranslate"><span class="pre">semantique</span></code>. This module contains all the built-in operators of the package. Note that the names of these functions always end with an underscore. This is simply to prevent collision with <a class="reference external" href="https://realpython.com/lessons/reserved-keywords/">reserved keywords</a> in Python.</p>
<p>It is also possible to use custom operators that you define for yourself, but we will not handle that here. See the Advanced usage notebook instead.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from semantique.processor import operators
</pre></div>
</div>
</div>
<div class="section" id="Simple-univariate-expressions">
<h4>Simple univariate expressions<a class="headerlink" href="#Simple-univariate-expressions" title="Permalink to this headline">¶</a></h4>
<p>The simplest form of expressions are the univariate expressions without any additional constants or parameters. For each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span> in input cube <span class="math notranslate nohighlight">\(X\)</span>, these expressions <em>only</em> consider <span class="math notranslate nohighlight">\(x_{i}\)</span>, and apply an operator to it. That is, the expression is of the following form.</p>
<div class="math notranslate nohighlight">
\[expression = operator(x_{i})\]</div>
<p>This means that the output cube has the same shape as the input cube, and that each pixel value in the output cube is the result of the univariate expression evaluated on the value of the corresponding pixel in the input cube.</p>
<p><img alt="evaluate_univariate" src="_notebooks/figures/evaluate_uni.png" /></p>
<p>The built-in operators for this purpose include the <strong>numerical univariate operators</strong>, which are intended for usage on numerical data cubes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">absolute</span></code>: Computes the absolute value of <span class="math notranslate nohighlight">\(x_{i}\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">natural_logarithm</span></code>: Computes the natural logarithm of <span class="math notranslate nohighlight">\(x_{i}\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">square_root</span></code>: Computes the square root of <span class="math notranslate nohighlight">\(x_{i}\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cube_root</span></code>: Computes the cube root of <span class="math notranslate nohighlight">\(x_{i}\)</span>.</p></li>
</ul>
<p>Next to those there are the <strong>boolean univariate operators</strong>, which are intended for usage on binary data cubes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">invert</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} = 0\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> if <span class="math notranslate nohighlight">\(x_{i} \neq 0\)</span>.</p></li>
</ul>
<p>For example, applying the <code class="docutils literal notranslate"><span class="pre">invert</span></code> operator to the water cube marks all non-water pixels as 1 and all water pixels as 0.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water.sq.evaluate(operators.invert_))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 0., 1., 1., 0., 1., 1., 1., 1.],
       [1., 1., 1., 0., 1., 1., 0., 1., 1.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;invert&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Univariate-expressions-involving-constants">
<h4>Univariate expressions involving constants<a class="headerlink" href="#Univariate-expressions-involving-constants" title="Permalink to this headline">¶</a></h4>
<p>Other expressions involve a constant value in addition to the pixel values from the input cube. Such expressions consist of a right-hand side value, a left-hand side value and an operator that in some way combines these values. For each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span> in input cube <span class="math notranslate nohighlight">\(X\)</span>, the right-hand side value of the expression is <span class="math notranslate nohighlight">\(x_{i}\)</span>, and the left-hand side value of the expression is a constant value <span class="math notranslate nohighlight">\(y\)</span>. Hence, <span class="math notranslate nohighlight">\(y\)</span> remains the same no matter for which pixel in <span class="math notranslate nohighlight">\(X\)</span>
the expression is evaluated. For example, we could add <code class="docutils literal notranslate"><span class="pre">1</span></code> to each pixel value, or multiply each pixel value by <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
<div class="math notranslate nohighlight">
\[expression = x_{i} \; operator \; y\]</div>
<p>This means that the output cube has the same shape as the input cube, and that each pixel value in the output cube is the result of the expression evaluated on the value of the corresponding pixel in the input cube, with each expression containing some constant value <span class="math notranslate nohighlight">\(y\)</span> which is the same for each pixel.</p>
<p><img alt="evaluate_constant" src="_notebooks/figures/evaluate_const.png" /></p>
<p>The built-in operators for this purpose can be subdivided into different categories. The <strong>algebraic operators</strong> are intended for usage on numerical data cubes and perform an operation of arithmetic:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add</span></code>: Adds some constant <span class="math notranslate nohighlight">\(y\)</span> to each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span>, e.g. <span class="math notranslate nohighlight">\(x_{i} + 2\)</span> when <span class="math notranslate nohighlight">\(y = 2\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subtract</span></code>: Subtracts some constant <span class="math notranslate nohighlight">\(y\)</span> from each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span>, e.g. <span class="math notranslate nohighlight">\(x_{i} - 2\)</span> when <span class="math notranslate nohighlight">\(y = 2\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multiply</span></code>: Multiplies each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span> by some constant <span class="math notranslate nohighlight">\(y\)</span>, e.g. <span class="math notranslate nohighlight">\(x_{i} \times 2\)</span> when <span class="math notranslate nohighlight">\(y = 2\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">divide</span></code>: Divides each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span> by some constant <span class="math notranslate nohighlight">\(y\)</span>, e.g. <span class="math notranslate nohighlight">\(\frac{x_{i}}{2}\)</span> when <span class="math notranslate nohighlight">\(y = 2\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">power</span></code>: Raises each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span> to the <em>y</em>th power for some constant <span class="math notranslate nohighlight">\(y\)</span>, e.g. <span class="math notranslate nohighlight">\(x_{i} ^ 2\)</span> when <span class="math notranslate nohighlight">\(y = 2\)</span>.</p></li>
</ul>
<p>The <strong>relational operators</strong> evaluate a condition involving two values. The result is always a boolean value, i.e. true (1) when the condition holds and false (2) when it doesn’t. Some of the conditions test for equality, and hence can be used on any data cube as long as the constant <span class="math notranslate nohighlight">\(y\)</span> matches the value type of the data cube:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">equal</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} = y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">not_equal</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} \neq y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} \in Y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise. Here, <span class="math notranslate nohighlight">\(Y\)</span> is a finite set of values that remains constant for each <span class="math notranslate nohighlight">\(x_{i}\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">not_in</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} \notin Y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise. Here, <span class="math notranslate nohighlight">\(Y\)</span> is a finite set of values that remains constant for each <span class="math notranslate nohighlight">\(x_{i}\)</span>.</p></li>
</ul>
<p>The other conditions imply a fixed order among the values, and hence should not be used on nominal data cubes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">greater</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} &gt; y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} &lt; y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">greater_equal</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} \geq y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less_equal</span></code>:Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} \leq y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(greenness)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;greenness&#39; (time: 3, space: 9)&gt;
array([[1.8, 1. , 1.7, 1.3, 1. , 1.6, 1.4, 1.2, 1.7],
       [6.3, nan, 9.6, 3.9, nan, 8.1, 5.1, 6.1, 5.6],
       [5.9, 1.1, 3.5, nan, 1. , 5. , 2.4, 1.9, 4.2]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    scale_factor:  1.0
    add_offset:    0.0
    long_name:     greenness
    _FillValue:    1.7976931348623157e+308
    value_type:    numerical
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(greenness.sq.evaluate(operators.multiply_, 2))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3, space: 9)&gt;
array([[ 3.6,  2. ,  3.4,  2.6,  2. ,  3.2,  2.8,  2.4,  3.4],
       [12.6,  nan, 19.2,  7.8,  nan, 16.2, 10.2, 12.2, 11.2],
       [11.8,  2.2,  7. ,  nan,  2. , 10. ,  4.8,  3.8,  8.4]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(greenness.sq.evaluate(operators.greater_, 2))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3, space: 9)&gt;
array([[ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.],
       [ 1., nan,  1.,  1., nan,  1.,  1.,  1.,  1.],
       [ 1.,  0.,  1., nan,  0.,  1.,  1.,  0.,  1.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above examples as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;greenness&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;multiply&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;greenness&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;greater&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Multivariate-expressions">
<h4>Multivariate expressions<a class="headerlink" href="#Multivariate-expressions" title="Permalink to this headline">¶</a></h4>
<p>In the examples above <span class="math notranslate nohighlight">\(y\)</span> remained the same no matter for which pixel in <span class="math notranslate nohighlight">\(X\)</span> the expression was evaluated. Instead, <span class="math notranslate nohighlight">\(y\)</span> could be a variable as well. That turns the same expressions into <em>multivariate expressions</em>. In practice this means that when evaluating the expression for the pixel with value <span class="math notranslate nohighlight">\(x_{i} \in X\)</span>, we set <span class="math notranslate nohighlight">\(y\)</span> to be equal to pixel value <span class="math notranslate nohighlight">\(y_{i}\)</span> taken from another data cube <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<div class="math notranslate nohighlight">
\[expression = x_{i} \; operator \; y_{i}\]</div>
<p>This means that the output cube has the same shape as the input cube, and that each pixel value in the output cube is the result of the multivariate expression evaluated on the value of the corresponding pixel in the input cube <em>and</em> the value of that pixel with the same coordinates in another data cube <span class="math notranslate nohighlight">\(Y\)</span>. Note that this does require that <span class="math notranslate nohighlight">\(Y\)</span> has the <em>same shape</em> as <span class="math notranslate nohighlight">\(X\)</span> (or at least can be aligned to that shape, which we will explain in the next sub-section). Only then, each
pixel in <span class="math notranslate nohighlight">\(X\)</span> has a <em>matching</em> pixel in <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p><img alt="evaluate_multivariate" src="_notebooks/figures/evaluate_multi.png" /></p>
<p>We can use the same algebraic expressions in these cases. These are meant to be used in expression in which both sides are numerical data cubes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add</span></code>: Adds pixel value <span class="math notranslate nohighlight">\(y_{i} \in Y\)</span> to each pixel value <span class="math notranslate nohighlight">\(x_{i} \in X\)</span>..</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subtract</span></code>: Subtracts pixel value <span class="math notranslate nohighlight">\(y_{i} \in Y\)</span> from each pixel value <span class="math notranslate nohighlight">\(x_{i} \in X\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multiply</span></code>: Multiplies each pixel value <span class="math notranslate nohighlight">\(x_{i} \in X\)</span> by pixel value <span class="math notranslate nohighlight">\(y_{i} \in Y\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">divide</span></code>: Divides each pixel value <span class="math notranslate nohighlight">\(x_{i} \in X\)</span> by pixel value <span class="math notranslate nohighlight">\(y_{i} \in Y\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">power</span></code>: Raises each pixel value <span class="math notranslate nohighlight">\(x_{i} \in X\)</span> to the <em>y</em>th power, where <span class="math notranslate nohighlight">\(y = y_{i} \in Y\)</span>.</p></li>
</ul>
<p>We can also use the relational operators that test for equality, except the <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">not_in</span></code> operators, since they expect a set of values as the right-hand side of the expression. The equality operators can be used on any data cube as long as the value type of the second data cube is the same as the value type of the first data cube:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">equal</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} = y_{i}\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">not_equal</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} \neq y_{i}\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
</ul>
<p>The same yields for the relational operators that imply a fixed order in the values of the cube: these can be used on any non-nominal data cube as long as the value type of the second data cube is the same as the value type of the first data cube:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">greater</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} &gt; y_{i}\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} &lt; y_{i}\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">greater_equal</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} \geq y_{i}\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less_equal</span></code>:Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} \leq y_{i}\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
</ul>
<p>The simplest (but pretty useless) example is to compare the water cube to itself. As expected, this returns an array with solely “true” values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water.sq.evaluate(operators.equal_, water))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">())</span>
</pre></div>
</div>
<p>Of course we are not bound to use the same cube as <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>. We just need to make sure both cubes have the same shape.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>greenness.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3, 9)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>brightness.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(3, 9)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(greenness.sq.evaluate(operators.add_, brightness))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3, space: 9)&gt;
array([[70.8, 66. , 94.7, 68.3, 65. , 76.6, 69.4, 93.2, 63.7],
       [29.3,  nan, 50.6, 19.9,  nan, 33.1, 20.1, 35.1, 22.6],
       [37.9, 53.1, 48.5,  nan, 34. , 34. , 16.4, 32.9, 20.2]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;greenness&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>There is an additional set of operators we can use for multivariate expressions. These are the <strong>boolean multivariate operators</strong>. The are intended to be used in expressions involving two binary data cubes.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">and</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> when both <span class="math notranslate nohighlight">\(x_{i} \neq 0\)</span> <em>and</em> <span class="math notranslate nohighlight">\(y_{i} \neq 0\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">or</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> when <span class="math notranslate nohighlight">\(x_{i} \neq 0\)</span>, <span class="math notranslate nohighlight">\(y_{i} \neq 0\)</span>, or both, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exclusive_or</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> when either <span class="math notranslate nohighlight">\(x_{i} \neq 0\)</span> <em>or</em> <span class="math notranslate nohighlight">\(y_{i} \neq 0\)</span>, but <em>not</em> both, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water.sq.evaluate(operators.and_, snow))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water.sq.evaluate(operators.or_, snow))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3, space: 9)&gt;
array([[1., 0., 1., 1., 0., 1., 1., 1., 1.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above examples as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">))</span>
<span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="Aligning-data-cubes-to-the-same-shape">
<h4>Aligning data cubes to the same shape<a class="headerlink" href="#Aligning-data-cubes-to-the-same-shape" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, cube <span class="math notranslate nohighlight">\(Y\)</span> does not necessarily have to be of the same shape as input cube <span class="math notranslate nohighlight">\(X\)</span>, but it should at least be possible to <em>align</em> it to that shape. This can be done in two ways.</p>
<p>First consider the case where <span class="math notranslate nohighlight">\(Y\)</span> has the same dimensions as <span class="math notranslate nohighlight">\(X\)</span>, but not all coordinate values of <span class="math notranslate nohighlight">\(X\)</span> are present in <span class="math notranslate nohighlight">\(Y\)</span>. In that case, we can align <span class="math notranslate nohighlight">\(Y\)</span> with <span class="math notranslate nohighlight">\(X\)</span> such that pixel values at position <span class="math notranslate nohighlight">\(i\)</span> in both cubes, i.e. <span class="math notranslate nohighlight">\(x_{i}\)</span> and <span class="math notranslate nohighlight">\(y_{i}\)</span> respectively, belong to pixels with the <em>same coordinates</em>. If <span class="math notranslate nohighlight">\(y_{i}\)</span> was not originally part of <span class="math notranslate nohighlight">\(Y\)</span>, we assign it a nodata value. In that way, we can at least correctly evaluate the
expression for those pixels in <span class="math notranslate nohighlight">\(X\)</span> that do have a matching pixel with a value in <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p><img alt="evaluate_align_same_dims" src="_notebooks/figures/evaluate_align1.png" /></p>
<p>Below we show an example. Since <code class="docutils literal notranslate"><span class="pre">align_with</span></code> is a method that operates on <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code> object but is added by <code class="docutils literal notranslate"><span class="pre">semantique</span></code>, we can also call it through the <code class="docutils literal notranslate"><span class="pre">sq</span></code> accessor, just as the verbs. Note that we just show the alignment process for the sake of demonstration. Whenever you call the <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> verb with a cube as y-value, the alignment is taken care of internally.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Recall the shape of our water cube.
print(water)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Now create a snow cube that has only a subset of the coordinates of the water cube.
snow_subset = snow.isel(space = range(3, 6))
print(snow_subset)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;snow&#39; (time: 3, space: 3)&gt;
array([[1., 0., 1.],
       [0., 0., 0.],
       [0., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.694e+06 2.694e+06 2.694e+06
  - x             (space) float64 4.532e+06 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Aligning it makes sure that pixels with equal coordinates in the snow and water cubes are at the same position.
print(snow_subset.sq.align_with(water))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;snow&#39; (time: 3, space: 9)&gt;
array([[nan, nan, nan,  1.,  0.,  1., nan, nan, nan],
       [nan, nan, nan,  0.,  0.,  0., nan, nan, nan],
       [nan, nan, nan,  0.,  0.,  0., nan, nan, nan]])
Coordinates:
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
    feature       (space) float64 nan nan nan 1.0 1.0 1.0 nan nan nan
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># The reverse is also true:
# When the input cube X has only a subset of the coordinates of the Y cube, we can align Y to X.
print(snow.sq.align_with(water.isel(space = range(3, 6))))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;snow&#39; (time: 3, space: 3)&gt;
array([[1., 0., 1.],
       [0., 0., 0.],
       [0., 0., 0.]])
Coordinates:
  * space         (space) MultiIndex
  - y             (space) float64 2.694e+06 2.694e+06 2.694e+06
  - x             (space) float64 4.532e+06 4.533e+06 4.535e+06
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
    feature       (space) float64 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>Now consider a case where <span class="math notranslate nohighlight">\(Y\)</span> has one or more dimensions with exactly the same coordinate values as <span class="math notranslate nohighlight">\(X\)</span>, but does not have <em>all</em> the dimensions that <span class="math notranslate nohighlight">\(X\)</span> has. In that case, we can align <span class="math notranslate nohighlight">\(Y\)</span> with <span class="math notranslate nohighlight">\(X\)</span> by duplicating its values along those dimensions that are missing.</p>
<p><img alt="evaluate_align_missing_dims" src="_notebooks/figures/evaluate_align2.png" /></p>
<p>For example, when <span class="math notranslate nohighlight">\(X\)</span> has a time and a space dimension, but <span class="math notranslate nohighlight">\(Y\)</span> only the time dimension, we can align <span class="math notranslate nohighlight">\(Y\)</span> to <span class="math notranslate nohighlight">\(X\)</span> as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Recall the shape of our water cube.
print(water)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Now create a snow cube that has only a time dimension.
snow_temporal = snow.isel(space = 8, drop = True)
print(snow_temporal)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;snow&#39; (time: 3)&gt;
array([1., 0., 0.])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Aligning it duplicates for each timestamp the values of Y along all spatial locations in X.
print(snow_temporal.sq.align_with(water))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;snow&#39; (time: 3, space: 9)&gt;
array([[1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>The latter behaviour is <em>not</em> symmetric. When cube <span class="math notranslate nohighlight">\(Y\)</span> has more dimensions that cube <span class="math notranslate nohighlight">\(X\)</span>, there is no clear way to define how to subset the values in <span class="math notranslate nohighlight">\(Y\)</span> to match the shape of <span class="math notranslate nohighlight">\(X\)</span>. In that case, the alignment will raise an error.</p>
</div>
<div class="section" id="The-assignment-operator">
<h4>The assignment operator<a class="headerlink" href="#The-assignment-operator" title="Permalink to this headline">¶</a></h4>
<p>A special operator is the <code class="docutils literal notranslate"><span class="pre">assign</span></code> operator. This operator assigns each pixel <span class="math notranslate nohighlight">\(x_{i}\)</span> of data cube <span class="math notranslate nohighlight">\(X\)</span> a new value that has nothing to do with the original value. The new value can either some constant <span class="math notranslate nohighlight">\(y\)</span>, or the corresponding pixel value <span class="math notranslate nohighlight">\(y_{i}\)</span> in another data cube <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>This operator becomes useful for example when you first filter your values based on some condition (using the <a class="reference external" href="#Filter">filter verb</a>), and then want to replace the remaining values with a pre-defined constant (i.e. using that value as some sort of label for those pixels that passed the condition).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(brightness.sq.filter(vegetation).sq.evaluate(operators.assign_, 999))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3, space: 9)&gt;
array([[ nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan],
       [999.,  nan, 999., 999.,  nan, 999., 999., 999., 999.],
       [999.,  nan,  nan,  nan,  nan, 999.,  nan,  nan, 999.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;vegetation&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;assign&quot;</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span>
</pre></div>
</div>
<p>Another useful example follows from alignment behaviour as explained in the previous section. This allows you to for example to replace all pixel values in a data cube by the timestamp (or a component of the timestamp, e.g. the year) at which they were observed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>years = water.time.dt.year
print(water.sq.evaluate(operators.assign_, years))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3, space: 9)&gt;
array([[2019., 2019., 2019., 2019., 2019., 2019., 2019., 2019., 2019.],
       [2020., 2020., 2020., 2020., 2020., 2020., 2020., 2020., 2020.],
       [2020., 2020., 2020., 2020., 2020., 2020., 2020., 2020., 2020.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;assign&quot;</span><span class="p">,</span> <span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="Temporal-relational-operators">
<h4>Temporal relational operators<a class="headerlink" href="#Temporal-relational-operators" title="Permalink to this headline">¶</a></h4>
<p>There is a special set of relational operators we did not touch upon yet: the <strong>temporal relational operators</strong>. These are comparison operators specifically designed to deal with <em>time instants</em> and <em>time intervals</em> as operand values. Hence, it requires each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span> in input cube <span class="math notranslate nohighlight">\(X\)</span> to be a time instant. The right-hand side of the expression can either be a single time instant, a time interval (i.e. a list of two time instant representing the start and end of the
interval) or another data cube <span class="math notranslate nohighlight">\(Y\)</span> in which each pixel value <span class="math notranslate nohighlight">\(y_{i}\)</span> in a time instant. The latter will in practice be evaluated as being a time interval with the earliest time instant being the start of the interval, and the latest time instant the end of the interval.</p>
<blockquote>
<div><p><strong>NOTE</strong> Time intervals are always assumed to be <em>closed</em> at both sides, i.e. both the start and end values are included in the interval</p>
</div></blockquote>
<p>The currently implemented temporal relational operators are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">after</span></code>: When <span class="math notranslate nohighlight">\(y\)</span> is a time instant: returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} &gt; y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise. When <span class="math notranslate nohighlight">\(y\)</span> is a time interval: returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} &gt; max(y)\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">before</span></code>: When <span class="math notranslate nohighlight">\(y\)</span> is a time instant: returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} &lt; y\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise. When <span class="math notranslate nohighlight">\(y\)</span> is a time interval: returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(x_{i} &lt; min(y)\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">during</span></code>: Returns <span class="math notranslate nohighlight">\(1\)</span> if <span class="math notranslate nohighlight">\(min(y) \leq x_{i} \leq max(y)\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise. Only intended for time intervals as <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
</ul>
<blockquote>
<div><p><strong>NOTE</strong> When constructing a query recipe, you can use the <code class="docutils literal notranslate"><span class="pre">sq.time_instant</span></code> and <code class="docutils literal notranslate"><span class="pre">sq.time_interval</span></code> functions to create time instants and time intervals. The first expects a single time value, the second expects two time values (i.e. start and end). Just as with initializing temporal extents, the provided time values can be in any format that the <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.Timestamp.html">Timestamp</a> initializer of the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package can understands. This
includes formats like <code class="docutils literal notranslate"><span class="pre">&quot;2020-12-31&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;2020/12/31&quot;</span></code>, but also complete ISO8601 timestamps. Any additional keyword arguments will be forwarded to pandas initializer. Internally the query processor will convert them to <code class="docutils literal notranslate"><span class="pre">numpy.datetime64</span></code> objects. Since we are calling the verbs here directly, we will forward them the numpy objects.</p>
<p><strong>NOTE</strong> Next to the temporal operators, it is also planned to implement specific <em>spatial</em> comparison operators such as <code class="docutils literal notranslate"><span class="pre">intersects</span></code>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>times = water.time
print(times.sq.evaluate(operators.after_, np.datetime64(&quot;2019-12-31&quot;)))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;time&#39; (time: 3)&gt;
array([0., 1., 1.])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(times.sq.evaluate(operators.during_, [np.datetime64(&quot;2019-12-01&quot;), np.datetime64(&quot;2020-12-01&quot;)]))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;time&#39; (time: 3)&gt;
array([1., 1., 0.])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above examples as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;after&quot;</span><span class="p">,</span> <span class="n">sq</span><span class="o">.</span><span class="n">time_instant</span><span class="p">(</span><span class="s2">&quot;2019-12-31&quot;</span><span class="p">))</span>
<span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;during&quot;</span><span class="p">,</span> <span class="n">sq</span><span class="o">.</span><span class="n">time_interval</span><span class="p">(</span><span class="s2">&quot;2019-12-30&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-12-30&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Extract">
<h3>Extract<a class="headerlink" href="#Extract" title="Permalink to this headline">¶</a></h3>
<p>The extract verbs extracts the coordinates of a specified dimension from a data cube.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water.sq.extract(&quot;time&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;time&#39; (time: 3)&gt;
array([&#39;2019-12-15T10:17:33.408715000&#39;, &#39;2020-09-05T10:17:43.167942000&#39;,
       &#39;2020-12-19T10:17:34.610661000&#39;], dtype=&#39;datetime64[ns]&#39;)
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
Attributes:
    value_type:  time
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Coordinate values of some dimensions may consist of multiple components. For example, the spatial dimension contains coordinate tuples that consist of x and y coordinates, and the time dimension contains timestamps that consist of a year, a month, a day, an hour, etc. If you are only interested in a single component of a dimension, you can specify that through the <code class="docutils literal notranslate"><span class="pre">component</span></code> argument of the extract verb:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water.sq.extract(&quot;time&quot;, &quot;year&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;year&#39; (time: 3)&gt;
array([2019, 2020, 2020])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
Attributes:
    value_type:  numerical
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Extracting coordinates of a (component of a) dimension is useful for example when you want to filter a data cube based on its dimension coordinates rather than based on its values (e.g. <a class="reference external" href="#Aligning-the-filterer">temporal filtering</a>), when you want to <a class="reference external" href="#Replace">replace</a> pixel values by their time of observation, or when you want to split a data cube into multiple groups along a dimension (e.g. <a class="reference external" href="#Groupby">grouping by year</a>).</p>
</div>
<div class="section" id="Filter">
<h3>Filter<a class="headerlink" href="#Filter" title="Permalink to this headline">¶</a></h3>
<p>The filter verb filters values from a data cube. That is, the output cube is a <em>subset</em> of the input cube. Which values in the input cube are kept, and which are removed, is defined by a second, boolean data cube which we call the <em>filterer</em>. The filterer should have the same shape as the input cube, such that each pixel value <span class="math notranslate nohighlight">\(x_{i}\)</span> in input cube <span class="math notranslate nohighlight">\(X\)</span> has a <em>matching</em> pixel value <span class="math notranslate nohighlight">\(y_{i}\)</span> in filterer <span class="math notranslate nohighlight">\(Y\)</span>. Then:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_{i}\)</span> is kept if <span class="math notranslate nohighlight">\(y_{i} \neq 0\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(x_{i}\)</span> is removed if <span class="math notranslate nohighlight">\(y_{i} = 0\)</span>.</p></li>
</ul>
<p>For example, we may filter only those greenness values of pixels where water or snow was observed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Recall the values of the brightness cube.
print(brightness)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;brightness&#39; (time: 3, space: 9)&gt;
array([[69., 65., 93., 67., 64., 75., 68., 92., 62.],
       [23.,  8., 41., 16.,  7., 25., 15., 29., 17.],
       [32., 52., 45., 11., 33., 29., 14., 31., 16.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    scale_factor:  1.0
    add_offset:    0.0
    long_name:     brightness
    _FillValue:    1.7976931348623157e+308
    value_type:    numerical
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Create the filterer by marking the pixels where water or snow was observed as &quot;true&quot;.
filterer = water.sq.evaluate(operators.or_, snow)
print(filterer)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3, space: 9)&gt;
array([[1., 0., 1., 1., 0., 1., 1., 1., 1.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Filter the values of the brightness cube using the filterer.
print(brightness.sq.filter(filterer))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;brightness&#39; (time: 3, space: 9)&gt;
array([[69., nan, 93., 67., nan, 75., 68., 92., 62.],
       [nan,  8., nan, nan,  7., nan, nan, nan, nan],
       [nan, nan, nan, 11., nan, nan, 14., nan, nan]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    scale_factor:  1.0
    add_offset:    0.0
    long_name:     brightness
    _FillValue:    1.7976931348623157e+308
    value_type:    numerical
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<div class="section" id="Aligning-the-filterer">
<h4>Aligning the filterer<a class="headerlink" href="#Aligning-the-filterer" title="Permalink to this headline">¶</a></h4>
<p>Just as with the <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(X\)</span> cubes in multivariate expressions in the <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> verb, the filterer does not have to be of the same shape as the input cube, as long as we can align it to that shape. That means that we can also filter the input cube by the coordinates of one of its dimensions. All we have to do is to construct a filterer for that dimension. Hence, a boolean, one-dimensional data cube that specifies for each of the coordinate values of that dimension if it should be
kept (i.e. 1) or removed (i.e. 0).</p>
<p>For example, when we only want to keep pixel values observed in 2019:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Extract the years from the time dimension.
years = water.sq.extract(&quot;time&quot;, &quot;year&quot;)
print(years)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;year&#39; (time: 3)&gt;
array([2019, 2020, 2020])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
Attributes:
    value_type:  numerical
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Create a filterer for the time dimension.
filterer = years.sq.evaluate(operators.equal_, 2020)
print(filterer)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (time: 3)&gt;
array([0., 1., 1.])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Filter the values of the water cube using the dimension filterer.
print(water.sq.filter(filterer))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[nan, nan, nan, nan, nan, nan, nan, nan, nan],
       [ 0.,  1.,  0.,  0.,  1.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  0.,  1.,  0.,  0.,  1.,  0.,  0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="mi">2020</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="The-filter_time-and-filter_space-verbs">
<h4>The filter_time and filter_space verbs<a class="headerlink" href="#The-filter_time-and-filter_space-verbs" title="Permalink to this headline">¶</a></h4>
<p>You can also use a handy shortcut for the above formulation: the <code class="docutils literal notranslate"><span class="pre">filter_time</span></code> verb. This allows you to apply a temporal filter <em>without</em> having to explicitly extract the time coordinates from the active evaluation object and evaluating a comparison expression on them. Hence, you could formulate exactly the same example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter_time</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="mi">2020</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this is only a “shortcut” verb, not an independent verb on its own. Hence, calling <code class="docutils literal notranslate"><span class="pre">filter_time</span></code> will result in a textual recipe that contains the self reference and the extract and evaluate verbs, i.e. that is exactly equal to the textual recipe of the first formulation. In the same way, you can also use <code class="docutils literal notranslate"><span class="pre">filter_space</span></code> for spatial filters.</p>
</div>
<div class="section" id="Self-filtering">
<h4>Self-filtering<a class="headerlink" href="#Self-filtering" title="Permalink to this headline">¶</a></h4>
<p>A special type of a filtering operation is self-filtering, i.e. filtering a data cube by itself. In this case, the input cube should be boolean. In the output, the “true” values will be preserved, while the “false” values are removed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water.sq.filter(water).sq.trim(force_regular = False))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 2, space: 6)&gt;
array([[nan,  1., nan,  1., nan, nan],
       [nan, nan,  1., nan,  1., nan]])
Coordinates:
  * time          (time) datetime64[ns] 2020-09-05T10:17:43.167942 2020-12-19...
    spatial_ref   int64 0
    temporal_ref  int64 0
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.532e+06 4.533e+06
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Reduce">
<h3>Reduce<a class="headerlink" href="#Reduce" title="Permalink to this headline">¶</a></h3>
<p>The reduce verb applies a reducer function along a dimension and subsequently drops the reduced dimension. That is, the output cube always has one dimension less than the input cube.</p>
<p>To reduce a dimension, the reducer function operates on each slice of values along the axis of the dimension. Such a <em>slice</em> contains one value for each coordinate label of the dimension to reduce over, while the coordinate labels of all other dimensions are <em>constant</em> within each slice. The reducer function always returns a single value, such that each slice gets reduced from <span class="math notranslate nohighlight">\(n\)</span> values to one value.</p>
<p>For example: a data cube with a spatial and a temporal dimension contains for each location in space <span class="math notranslate nohighlight">\(n\)</span> values, where <span class="math notranslate nohighlight">\(n\)</span> is the number of timestamps in the temporal dimension. When we reduce the temporal dimension of this cube, the reducer function reduces these <span class="math notranslate nohighlight">\(n\)</span> values for each location in space to one value. The resulting cube has a single value per location in space, and no temporal dimension anymore.</p>
<p>Several common reducers are built in to <code class="docutils literal notranslate"><span class="pre">semantique</span></code>. When you construct a semantic query recipe, you can simply call them by their name, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, since we are now calling the verbs directly as methods of <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code> object, we need to provide the reducer <em>functions</em> themselves. For that, we load the reducers module of <code class="docutils literal notranslate"><span class="pre">semantique</span></code>. This module contains all the built-in reducers of the package. Note that the names of these functions always end with an underscore. This is simply to prevent collision with reserved <a class="reference external" href="https://realpython.com/lessons/reserved-keywords/">keywords</a> in Python.</p>
<p>It is also possible to use custom reducers that you define for yourself, but we will not handle that here. See the Advanced usage notebook instead.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import geopandas as gpd
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>space.features.to_crs(3035).geometry
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    POLYGON ((4530114.000 2690997.000, 4530114.000...
Name: geometry, dtype: geometry
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>space.features.to_crs(3035).geometry.bounds
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>minx</th>
      <th>miny</th>
      <th>maxx</th>
      <th>maxy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.530114e+06</td>
      <td>2.690997e+06</td>
      <td>4.535867e+06</td>
      <td>2.696634e+06</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>4531114, 2690997, 4535867, 2695634
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4531114, 2690997, 4535867, 2695634)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from semantique.processor import reducers
</pre></div>
</div>
</div>
<p>The are many different types of reducers available. The <strong>numerical reducers</strong> should be used only on numerical data cubes. The reduced cube will be numerical as well.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mean</span></code>: Returns the average value of each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">product</span></code>: Returns the product of the values in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum</span></code>: Returns the sum of the values in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standard_deviation</span></code>: Returns the standard deviation of the values in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">variance</span></code>: Returns the variance of the values in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
</ul>
<p>In the same way, the <strong>boolean reducers</strong> should be used only on boolean data cubes, and the reduced cube will be boolean as well.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">all</span></code>: For each slice <span class="math notranslate nohighlight">\(S\)</span>, returns <span class="math notranslate nohighlight">\(1\)</span> if all <span class="math notranslate nohighlight">\(x_{i} \in S \neq 0\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">any</span></code>: For each slice <span class="math notranslate nohighlight">\(S\)</span>, returns <span class="math notranslate nohighlight">\(1\)</span> if any <span class="math notranslate nohighlight">\(x_{i} \in S \neq 0\)</span>, and <span class="math notranslate nohighlight">\(0\)</span> otherwise.</p></li>
</ul>
<p>Also the <strong>count reducers</strong> should only be used on boolean data cubes. However, the resulting data cubes will be numerical. The count reducers count the number of “true” observations. Where <code class="docutils literal notranslate"><span class="pre">count</span></code> is an absolute count, <code class="docutils literal notranslate"><span class="pre">percentage</span></code> makes it relative by calculating the percentage of “true” observations among all observations. Usually the latter is prefered, since the total amount of observations can differ among e.g. different moments in time and/or different spatial locations.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">count</span></code>: Counts the number of non-zero values in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">percentage</span></code>: Calculates the percentage of non-zero values in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
</ul>
<p>The <strong>universal reducers</strong> can be applied to a data cube of any value type. They just return one of the existing values for each slice. Hence, the reduced cube will have the same value type as the input cube.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>: Returns the most occuring value in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">first</span></code>: Returns the first value of each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last</span></code>: Returns the last value of each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
</ul>
<p>The <strong>ordered reducers</strong> also return one of the existing values for each slice. However, they imply a fixed order of the values. Therefore, these reducers should not be applied to nominal data cubes.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code>: Returns the largest value in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min</span></code>: Returns the smallest value in each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">median</span></code>: Returns the median value of each slice <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
</ul>
<p>It is important to mention that nodata values are <strong>ignored</strong> by the reducer functions! That is, for example, when a slice has the values <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">1,</span> <span class="pre">nan,</span> <span class="pre">1]</span></code> the <code class="docutils literal notranslate"><span class="pre">all</span></code> reducer will return <code class="docutils literal notranslate"><span class="pre">1</span></code> and the <code class="docutils literal notranslate"><span class="pre">percentage</span></code> reducer will return <code class="docutils literal notranslate"><span class="pre">100</span></code>. A reducer will only return a nodata value when <em>all</em> values in a slice are nodata values.</p>
<p>Having said that, lets show some examples. The <code class="docutils literal notranslate"><span class="pre">reduce</span></code> verb takes as first argument the name of the dimension to be reduced over, and as second argument the reducer function to be applied.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(snow)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;snow&#39; (time: 3, space: 9)&gt;
array([[1., 0., 1., 1., 0., 1., 1., 1., 1.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(snow.sq.reduce(&quot;time&quot;, reducers.count_))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;snow&#39; (space: 9)&gt;
array([1., 0., 1., 1., 0., 1., 1., 1., 1.])
Coordinates:
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(snow.sq.reduce(&quot;space&quot;, reducers.count_))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;snow&#39; (time: 3)&gt;
array([7., 0., 0.])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(brightness.sq.reduce(&quot;space&quot;, reducers.mean_))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;brightness&#39; (time: 3)&gt;
array([72.77777778, 20.11111111, 29.22222222])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above examples as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
<span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
<span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Groupby">
<h3>Groupby<a class="headerlink" href="#Groupby" title="Permalink to this headline">¶</a></h3>
<p>The groupby verb splits a data cube into multiple smaller data cubes, called groups. That is, the output cube is a collection of multiple subsets of the input cube. Grouping is always done <em>along</em> a dimension. That means that first the coordinate labels of this dimension are divided into distinct groups. Then, the input cube is split such that for each of these groups there is a subset of the input cube containing all pixels that have a coordinate for the given dimension which matches a label in
the group. How the coordinate labels are grouped is defined by a second, categorical data cube which we call the <em>grouper</em>. The grouper should be a one-dimensional data cube with a dimension that <em>matches</em> an existing dimension in the input cube. Then:</p>
<ul class="simple">
<li><p>Coordinate labels <span class="math notranslate nohighlight">\(\theta_{i}\)</span> and <span class="math notranslate nohighlight">\(\theta_{j}\)</span> of grouper <span class="math notranslate nohighlight">\(Y\)</span> are in the same group if and only if <span class="math notranslate nohighlight">\(y_{i} = y_{j}\)</span>.</p></li>
</ul>
<p>For example, we may group the water cube along the time dimension such that pixels observed in different years end up in different subsets. The result of this operation is an object of class <code class="docutils literal notranslate"><span class="pre">CubeCollection</span></code>, which is nothing more than a list of multiple data cubes. These <code class="docutils literal notranslate"><span class="pre">CubeCollection</span></code> object have specific verbs to combine their elements into a single data cube again. For a description of thos, see <a class="reference external" href="#Verbs-for-data-cube-collections">this section</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>grouper = water.sq.extract(&quot;time&quot;, &quot;year&quot;)
print(grouper)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;year&#39; (time: 3)&gt;
array([2019, 2020, 2020])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
Attributes:
    value_type:  numerical
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>groups = water.sq.groupby(grouper)

for group in groups:
    print(group)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray 2019 (time: 1, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
&lt;xarray.DataArray 2020 (time: 2, space: 9)&gt;
array([[0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2020-09-05T10:17:43.167942 2020-12-19...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="The-groupby_time-and-groupby_space-verbs">
<h4>The groupby_time and groupby_space verbs<a class="headerlink" href="#The-groupby_time-and-groupby_space-verbs" title="Permalink to this headline">¶</a></h4>
<p>You can also use a handy shortcut for the above formulation: the <code class="docutils literal notranslate"><span class="pre">groupby_time</span></code> verb. This allows you to group along the temporal dimension <em>without</em> having to explicitly extract the time coordinates from the active evaluation object. Hence, you could formulate exactly the same example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby_time</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this is only a “shortcut” verb, not an independent verb on its own. Hence, calling <code class="docutils literal notranslate"><span class="pre">groupby_time</span></code> will result in a textual recipe that contains the self reference and the extract verb, i.e. that is exactly equal to the textual recipe of the first formulation. In the same way, you can also use <code class="docutils literal notranslate"><span class="pre">groupby_space</span></code> for grouping directly along the spatial dimension.</p>
</div>
<div class="section" id="Multiple-groupers">
<h4>Multiple groupers<a class="headerlink" href="#Multiple-groupers" title="Permalink to this headline">¶</a></h4>
<p>It is also possible to provide a list (or <code class="docutils literal notranslate"><span class="pre">CubeCollection</span></code>) of groupers to the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> verb, as long as their dimensions match. In that case, groups of coordinate labels are formed as follows:</p>
<ul class="simple">
<li><p>Given grouper <span class="math notranslate nohighlight">\(Y\)</span> and grouper <span class="math notranslate nohighlight">\(Z\)</span> with matching coordinates, coordinate labels <span class="math notranslate nohighlight">\(\theta_{i}\)</span> and <span class="math notranslate nohighlight">\(\theta_{j}\)</span> are in the same group if and only if <span class="math notranslate nohighlight">\(y_{i} = y_{j}\)</span> <em>and</em> <span class="math notranslate nohighlight">\(z_{i} = z_{j}\)</span>.</p></li>
</ul>
<p>That means for example that we can group the input cube along the time dimension in a way that two pixels observed in the same month but a different year end up in a different subset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Grouping just by month returns a collection of two cubes: one for september and one for december.
groups = water.sq.groupby(water.sq.extract(&quot;time&quot;, &quot;month&quot;))

for group in groups:
    print(group)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray 9 (time: 1, space: 9)&gt;
array([[0., 1., 0., 0., 1., 0., 0., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2020-09-05T10:17:43.167942
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
&lt;xarray.DataArray 12 (time: 2, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 2020-12-19...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># When we group instead by month *and* year, we get a collection of three cubes.
# Since two of our december timestamps are in different years.
groups = water.sq.groupby([water.sq.extract(&quot;time&quot;, &quot;year&quot;), water.sq.extract(&quot;time&quot;, &quot;month&quot;)])

for group in groups:
    print(group)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray (2019, 12) (space: 9)&gt;
array([0., 0., 0., 0., 0., 0., 0., 0., 0.])
Coordinates:
    time          datetime64[ns] 2019-12-15T10:17:33.408715
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
&lt;xarray.DataArray (2020, 9) (space: 9)&gt;
array([0., 1., 0., 0., 1., 0., 0., 0., 0.])
Coordinates:
    time          datetime64[ns] 2020-09-05T10:17:43.167942
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
&lt;xarray.DataArray (2020, 12) (space: 9)&gt;
array([0., 0., 0., 1., 0., 0., 1., 0., 0.])
Coordinates:
    time          datetime64[ns] 2020-12-19T10:17:34.610661
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grouper</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">))</span>
<span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouper</span><span class="p">)</span>
</pre></div>
</div>
<p>Or equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby_time</span><span class="p">([</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Another example, focusing on the spatial dimension, is the following. Recall that our water cube has a space dimension of length 9, i.e. there are 9 pixels in our spatial extent. Each of them has a unique pair of an x and y coordinate. There are 3 distinct x coordinate values, and 3 distinct y coordinate values. That is, when we group our water cube along the space dimension with the groups based on x coordinate values, we end up with 3 subsets. The same yields when we base the groups on y
coordinate values. However, when we base the groups on the <em>combination</em> of x <em>and</em> y coordinate values, we should get 9 subsets. In that case, each pixel forms its own subset, since each pixel has a unique combination of x and y coordinate values.</p>
<p>Lets confirm this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>x_grouper = water.sq.extract(&quot;space&quot;, &quot;x&quot;)
print(x_grouper)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;x&#39; (space: 9)&gt;
array([4531500., 4533300., 4535100., 4531500., 4533300., 4535100., 4531500.,
       4533300., 4535100.])
Coordinates:
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  numerical
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>y_grouper = water.sq.extract(&quot;space&quot;, &quot;y&quot;)
print(y_grouper)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;y&#39; (space: 9)&gt;
array([2695500., 2695500., 2695500., 2693700., 2693700., 2693700., 2691900.,
       2691900., 2691900.])
Coordinates:
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  numerical
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Grouping the water cube by x coordinate values gives a collection with four subsets.
len(water.sq.groupby(x_grouper))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Grouping the water cube by y coordinate values gives a collection with four subsets.
len(water.sq.groupby(y_grouper))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># Grouping the water cube by x *and* y coordinate values gives a collection with sixteen subsets.
len(water.sq.groupby([x_grouper, y_grouper]))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
9
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grouper</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
<span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouper</span><span class="p">)</span>
</pre></div>
</div>
<p>Or equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby_space</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Label">
<h3>Label<a class="headerlink" href="#Label" title="Permalink to this headline">¶</a></h3>
<p>One additional verb is the label verb. This verb does not perform any analytical task, but simply assigns a label to the input cube. In some cases this can be helpful. For example, when concatenating multiple cubes together along a new dimension (see <a class="reference external" href="#Concatenate">here</a>), the labels of these cubes will be used as coordinate labels of this new dimension.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(water.sq.label(&quot;some_other_name&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;some_other_name&#39; (time: 3, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;some_other_name&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Verbs-for-data-cube-collections">
<h2>Verbs for data cube collections<a class="headerlink" href="#Verbs-for-data-cube-collections" title="Permalink to this headline">¶</a></h2>
<p>When constructing a query recipe, you can start a processing chain with a reference to a collection of data cubes, i.e. by calling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">cube_reference_1</span><span class="p">,</span> <span class="n">cube_reference_2</span><span class="p">,</span> <span class="n">cube_reference_3</span><span class="p">)</span>
</pre></div>
</div>
<p>Internally, the query processor models such a collection by an object of class <code class="docutils literal notranslate"><span class="pre">CubeCollection</span></code>. In practice, this is nothing more than a list of <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code> objects. Specific verbs are implemented for this class. All of them in some way combine the data cubes in the collection into a single data cube. Since a <code class="docutils literal notranslate"><span class="pre">CubeCollection</span></code> is a collection of xarray objects rather than an xarray object itself, it is not modelled as an accessor. Therefore, you don’t call the methods with the
prefix <code class="docutils literal notranslate"><span class="pre">sq.</span></code>, as was the case with the single data cube verbs.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from semantique.processor.structures import CubeCollection
</pre></div>
</div>
</div>
<p>It is important to mention that the verbs are intended for a collection of cubes that all have the <em>same</em> dimensions (but not necessarily the same coordinates)! They will also work on a collection of cubes that do not have the same dimensions, as long as they can be aligned to each other. However, in these cases you should be aware of the pecularities of <a class="reference external" href="#Aligning-data-cubes-to-the-same-shape">alignment</a>. Existing values will simply be duplicated over the missing dimensions, and that might
not always be intuitive. In the examples below we will focus on collections of cubes that all have the same dimensions.</p>
<p>The currently implemented verbs are:</p>
<ul class="simple">
<li><p><a class="reference external" href="#Concatenate">Concatenate</a>: Concatenates multiple data cubes over a new or an existing dimension.</p></li>
<li><p><a class="reference external" href="#Compose">Compose</a>: Creates a categorical composition of multiple boolean data cubes.</p></li>
<li><p><a class="reference external" href="#Merge">Merge</a>: For each pixel, merges its values in multiple data cubes into one by applying a reducer function.</p></li>
</ul>
<div class="section" id="Concatenate">
<h3>Concatenate<a class="headerlink" href="#Concatenate" title="Permalink to this headline">¶</a></h3>
<p>The concatenate verb concatenates multiple data cubes along a given dimension. There are two main ways in which you can do this: either you concatenate along a <em>new</em> dimension, or you concatenate along an <em>existing</em> dimension.</p>
<div class="section" id="Concatenating-along-a-new-dimension">
<h4>Concatenating along a new dimension<a class="headerlink" href="#Concatenating-along-a-new-dimension" title="Permalink to this headline">¶</a></h4>
<p>Concatenating multiple data cubes along a new dimension is a relatively simple process. Each of the input cubes becomes a dimension in the output cube. Lets consider a collection with two two-dimensional data cubes <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> that have matching coordinates along the dimensions <span class="math notranslate nohighlight">\(\Gamma\)</span> and <span class="math notranslate nohighlight">\(\Delta\)</span>. Concatenating them along a new dimension <span class="math notranslate nohighlight">\(E\)</span> will result in a new three-dimensional cube <span class="math notranslate nohighlight">\(C\)</span> with dimensions <span class="math notranslate nohighlight">\(\Gamma\)</span>, <span class="math notranslate nohighlight">\(\Delta\)</span> and <span class="math notranslate nohighlight">\(E\)</span>. A pixel
with coordinates <span class="math notranslate nohighlight">\((\gamma_{i}, \delta_{i})\)</span> in cube <span class="math notranslate nohighlight">\(A\)</span> becomes a pixel with coordinates <span class="math notranslate nohighlight">\((\gamma_{i}, \delta_{i}, \epsilon = A)\)</span> in cube <span class="math notranslate nohighlight">\(C\)</span>, while the pixel with the same coordinates <span class="math notranslate nohighlight">\((\gamma_{i}, \delta_{i})\)</span> in cube <span class="math notranslate nohighlight">\(B\)</span> becomes a pixel with coordinates <span class="math notranslate nohighlight">\((\gamma_{i}, \delta_{i}, \epsilon = B)\)</span> in cube <span class="math notranslate nohighlight">\(C\)</span>.</p>
<p>All you have to provide to the <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> verb is the name of the new dimension. Note that the coordinate labels of this new dimension will match the labels of the input cubes.</p>
<blockquote>
<div><p><strong>NOTE</strong> Be careful with using <em>time</em> and <em>space</em> as names for your new dimension. The dimension name <em>time</em> is reserved by <code class="docutils literal notranslate"><span class="pre">semantique</span></code> for a temporal dimension with coordinate labels that are full time instants (i.e. datetime objects), while the dimension name <em>space</em> is reserved by <code class="docutils literal notranslate"><span class="pre">semantique</span></code> for a spatial dimension with coordinate labels that are (x,y) coordinate pairs. Also, the names <em>x</em> and <em>y</em>, <em>longitude</em> and <em>latitude</em> and <em>lon</em> and <em>lat</em> are generally used for the individual
coordinate dimensions that make up the stacked <em>space</em> dimension.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(CubeCollection([water, snow, vegetation]).concatenate(&quot;concept&quot;).sq.label(&quot;concepts&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;concepts&#39; (concept: 3, time: 3, space: 9)&gt;
array([[[0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 1., 0., 0., 1., 0., 0., 0., 0.],
        [0., 0., 0., 1., 0., 0., 1., 0., 0.]],

       [[1., 0., 1., 1., 0., 1., 1., 1., 1.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0.]],

       [[0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 0., 1., 1., 0., 1., 1., 1., 1.],
        [1., 0., 0., 0., 0., 1., 0., 0., 1.]]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
  * concept       (concept) object &#39;water&#39; &#39;snow&#39; &#39;vegetation&#39;
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;vegetation&quot;</span><span class="p">))</span><span class="o">.</span>\
    <span class="n">concatenate</span><span class="p">(</span><span class="s2">&quot;concept&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">label</span><span class="p">(</span><span class="s2">&quot;concepts&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>When the input cubes have the same dimensions, but don’t share all of their coordinate labels, they get aligned to each other by filling the missing pixels with nodata values. The coordinates of the output cube are always the <em>union</em> of all coordinates from the input cubes. Only when the input cubes can in no way be aligned to each other, concatenation will fail.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>filterer = water.sq.extract(&quot;time&quot;, &quot;year&quot;).sq.evaluate(operators.equal_, 2020)
water_subset = water.sq.filter(filterer).sq.label(&quot;subset&quot;)
print(water_subset)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;subset&#39; (time: 3, space: 9)&gt;
array([[nan, nan, nan, nan, nan, nan, nan, nan, nan],
       [ 0.,  1.,  0.,  0.,  1.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  0.,  1.,  0.,  0.,  1.,  0.,  0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(CubeCollection([water, water_subset]).concatenate(&quot;foo&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (foo: 2, time: 3, space: 9)&gt;
array([[[ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.],
        [ 0.,  1.,  0.,  0.,  1.,  0.,  0.,  0.,  0.],
        [ 0.,  0.,  0.,  1.,  0.,  0.,  1.,  0.,  0.]],

       [[nan, nan, nan, nan, nan, nan, nan, nan, nan],
        [ 0.,  1.,  0.,  0.,  1.,  0.,  0.,  0.,  0.],
        [ 0.,  0.,  0.,  1.,  0.,  0.,  1.,  0.,  0.]]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
  * foo           (foo) object &#39;water&#39; &#39;subset&#39;
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="mi">2020</span><span class="p">))</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;subset&quot;</span><span class="p">)</span>
<span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">),</span> <span class="n">sub</span><span class="p">)</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter_time</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="mi">2020</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;subset&quot;</span><span class="p">)</span>
<span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">),</span> <span class="n">sub</span><span class="p">)</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Concatenating-over-an-existing-dimension">
<h4>Concatenating over an existing dimension<a class="headerlink" href="#Concatenating-over-an-existing-dimension" title="Permalink to this headline">¶</a></h4>
<p>Concatenating over an existing dimension is mainly meant for cases where each of the input cubes has different coordinate labels for that dimension. For example, we have one cube with a time dimension containing dates in 2019, and another one with a time dimension containing dates in 2020. Then, concatenating them over the time dimension gives us a single cube with a time dimension containing both the dates from 2019 and 2020.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>collection = water.sq.groupby(water.sq.extract(&quot;time&quot;, &quot;year&quot;))

for element in collection:
    print(element)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray 2019 (time: 1, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
&lt;xarray.DataArray 2020 (time: 2, space: 9)&gt;
array([[0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2020-09-05T10:17:43.167942 2020-12-19...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(collection.concatenate(&quot;time&quot;).sq.label(&quot;water&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">groupby</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">))</span><span class="o">.</span>\
    <span class="n">concatenate</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">label</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">groupby_time</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">concatenate</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">label</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also concatenate cubes that share coordinate labels of the dimension to concatenate over. However, for these coordinates, only the values of the <em>first</em> cube in the collection that contains that coordinate, will end up in the output cube. For the others, these labels will simply be dropped. That means for example that when you try to concatenate the water and snow cubes along the time dimension, you will end up with a cube that is identical to the water cube, since both cubes contain
exactly the same time coordinates, and the water cube is the first cube in the collection.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(CubeCollection([water, snow]).concatenate(&quot;time&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;water&#39; (time: 3, space: 9)&gt;
array([[0., 0., 0., 0., 0., 0., 0., 0., 0.],
       [0., 1., 0., 0., 1., 0., 0., 0., 0.],
       [0., 0., 0., 1., 0., 0., 1., 0., 0.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:  binary
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Compose">
<h3>Compose<a class="headerlink" href="#Compose" title="Permalink to this headline">¶</a></h3>
<p>The compose verb is primarily meant for collections of boolean data cubes, i.e. data cubes that only have “true” (i.e. 1) and “false” (i.e. 0) values. Then, a pixel in the output cube gets a <code class="docutils literal notranslate"><span class="pre">1</span></code> when it was “true” in the first cube of the collection, a <code class="docutils literal notranslate"><span class="pre">2</span></code> of it was “true” in the second cube of the collection, a <code class="docutils literal notranslate"><span class="pre">3</span></code> if it was “true” in the third cube of the collection, et cetera. Hence, with the compose verb you convert a set of boolean data cubes into one categorical data cube.</p>
<p>When a pixel is “true” in more than one cube in the collection, it gets the index of that cube that comes first in the collection. Hence, if a pixel is “true” in both the second and third cube in a collection, it gets a <code class="docutils literal notranslate"><span class="pre">2</span></code> in the output cube. When a pixel is not “true” for any of the cubes in the collection, it gets a nodata value in the output cube.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(CubeCollection([water, snow, vegetation]).compose().sq.label(&quot;land_cover&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;land_cover&#39; (time: 3, space: 9)&gt;
array([[ 2., nan,  2.,  2., nan,  2.,  2.,  2.,  2.],
       [ 3.,  1.,  3.,  3.,  1.,  3.,  3.,  3.,  3.],
       [ 3., nan, nan,  1., nan,  3.,  1., nan,  3.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
Attributes:
    value_type:    nominal
    value_labels:  {&#39;water&#39;: 1, &#39;snow&#39;: 2, &#39;vegetation&#39;: 3}
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;vegetation&quot;</span><span class="p">))</span><span class="o">.</span>\
    <span class="n">compose</span><span class="p">()</span><span class="o">.</span>\
    <span class="n">label</span><span class="p">(</span><span class="s2">&quot;land_cover&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Merge">
<h3>Merge<a class="headerlink" href="#Merge" title="Permalink to this headline">¶</a></h3>
<p>The merge verb is actually a combination of two other verbs. First, it <a class="reference external" href="#Concatenate">concatenates</a> the cubes in the collection along a new dimension, and then it <a class="reference external" href="#Reduce">reduces</a> the output of that over this new dimension. In practice, that means that the merge verb applies a reduction function to each set of values belonging to the same pixel, but coming from different elements in the cube collection. For example, if we merge the water, snow and vegetation cube using the <code class="docutils literal notranslate"><span class="pre">any</span></code>
reducer, we get an output cube that contains a “true” value (i.e. 1) for a pixel if the value of that pixel was “true” in at least one of the water, snow or vegetation cubes, and a “false” value (i.e. 0) if the value of that pixel was not “true” in any of those.</p>
<p>The only argument you need to provide to the verb is the reducer function. See the <a class="reference external" href="#Reduce">reduce verb</a> for an overview of them. Recall that when constructing a query recipe, you would call reducer function by their name, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, since we are now showing the functionalities of the verbs by how their are internally called, we need to provide the <em>functions</em> themselves.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(CubeCollection([water, snow, vegetation]).merge(reducers.any_).sq.label(&quot;any_concept&quot;).astype(&quot;float&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;any_concept&#39; (time: 3, space: 9)&gt;
array([[1., 0., 1., 1., 0., 1., 1., 1., 1.],
       [1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [1., 0., 0., 1., 0., 1., 1., 0., 1.]])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
  * space         (space) MultiIndex
  - y             (space) float64 2.696e+06 2.696e+06 ... 2.692e+06 2.692e+06
  - x             (space) float64 4.532e+06 4.533e+06 ... 4.533e+06 4.535e+06
    feature       (space) float64 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;snow&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;vegetation&quot;</span><span class="p">))</span><span class="o">.</span>\
    <span class="n">merge</span><span class="p">(</span><span class="s2">&quot;any&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">label</span><span class="p">(</span><span class="s2">&quot;any_concept&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the process of merging a collection of two cubes usually can be modelled as well with the <a class="reference external" href="#Evaluate">evaluate verb</a>. For example, the following lines produce identical results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
<span class="n">A</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;or&quot;</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
<p>However, where the evaluate verb can “merge” one other cube into a given input cube, the merge verb allows to combine an unrestricted number of cubes in one go. Because of that, only <a class="reference external" href="https://www.mathwords.com/c/commutative.htm">commutative operations</a> are supported in the merge verb.</p>
</div>
<div class="section" id="Evaluating-single-cube-verbs-on-collections">
<h3>Evaluating single cube verbs on collections<a class="headerlink" href="#Evaluating-single-cube-verbs-on-collections" title="Permalink to this headline">¶</a></h3>
<p>All <a class="reference external" href="#Verbs-for-single-data-cubes">verbs for single data cubes</a>, except <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, can also be applied to <code class="docutils literal notranslate"><span class="pre">CubeCollection</span></code> objects. In that case, they will simply be applied to each element of the collection seperately. Hence, the output will again be a <code class="docutils literal notranslate"><span class="pre">CubeCollection</span></code>, with the same amount of members.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>output = CubeCollection([greenness, brightness]).reduce(&quot;space&quot;, reducers.mean_)

for array in output:
    print(array)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;greenness&#39; (time: 3)&gt;
array([1.41111111, 6.38571429, 3.125     ])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
&lt;xarray.DataArray &#39;brightness&#39; (time: 3)&gt;
array([72.77777778, 20.11111111, 29.22222222])
Coordinates:
  * time          (time) datetime64[ns] 2019-12-15T10:17:33.408715 ... 2020-1...
    spatial_ref   int64 0
    temporal_ref  int64 0
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;greenness&quot;</span><span class="p">),</span> <span class="n">sq</span><span class="o">.</span><span class="n">appearance</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows to model well-know “split-apply-combine” processes, such as aggregation. You start with a single data cube, split it with the <a class="reference external" href="#Groupby">groupby</a> verb into a collection, apply one of the verbs for single data cubes to each of its members, and then combine them back together using one of the verbs for cube collections.</p>
<p>For example: we want to know the average water count over space for each year in our time dimension separately.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>years = water.time.dt.year

combined = water.\
    sq.groupby(years).\
    reduce(&quot;space&quot;, reducers.count_).\
    reduce(&quot;time&quot;, reducers.mean_).\
    concatenate(&quot;year&quot;).\
    sq.label(&quot;count&quot;)

print(combined)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;count&#39; (year: 2)&gt;
array([0., 2.])
Coordinates:
    spatial_ref   int64 0
    temporal_ref  int64 0
  * year          (year) int64 2019 2020
</pre></div></div>
</div>
<p>When constructing a query recipe, we would formulate the above example as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">groupby</span><span class="p">(</span><span class="n">sq</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">))</span><span class="o">.</span>\
    <span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">label</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or equivalently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sq</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">groupby_time</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">label</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="references.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">References</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="advanced.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Advanced usage</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
            &copy; Copyright 2021, Department of Geoinformatics – Z_GIS.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>